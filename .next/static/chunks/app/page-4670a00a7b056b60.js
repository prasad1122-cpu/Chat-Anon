(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{762:function(e,t,a){Promise.resolve().then(a.bind(a,1490))},1490:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var n=a(7437),s=a(2265),i=a(5236),l=a(5735),c=a(9842);let r=(0,i.C6)().length?(0,i.C6)()[0]:(0,i.ZF)({apiKey:"AIzaSyBfqLCAQz1vhhPEcbR448uztb5waPw4IBI",authDomain:"anon-f7811.firebaseapp.com",projectId:"anon-f7811",storageBucket:"anon-f7811.appspot.com",messagingSenderId:"455237287448",appId:"1:455237287448:web:c7ae04f2242ec5e7340d6d",measurementId:"G-KQ0W1T5R99"}),o=(0,l.v0)(r),u=(0,c.ad)(r);async function d(){return o.currentUser?o.currentUser:(await (0,l.XB)(o),new Promise(e=>{let t=(0,l.Aj)(o,a=>{a&&(t(),e(a))})}))}async function h(e,t){let a=(0,c.JU)(u,"queue",e);await (0,c.pl)(a,{uid:e,...t,createdAt:(0,c.Bt)()});let n=(0,c.IO)((0,c.hJ)(u,"queue")),s=await (0,c.PL)(n),i=null;if(s.forEach(a=>{let n=a.data();n.uid!==e&&function(e,t){var a,n,s,i;let l=null!==(a=e.want)&&void 0!==a?a:"any",c=null!==(n=t.want)&&void 0!==n?n:"any",r=null!==(s=e.gender)&&void 0!==s?s:"other",o=null!==(i=t.gender)&&void 0!==i?i:"other";return("any"===l||l===o)&&("any"===c||c===r)}(t,n)&&!i&&(i=n)}),!i)return{status:"waiting"};let l=i.uid,r=[e,l].sort().join("_"),o=(0,c.JU)(u,"matches",r);return await (0,c.i3)(u,async t=>{(await t.get(o)).exists()||(t.delete((0,c.JU)(u,"queue",e)),t.delete((0,c.JU)(u,"queue",l)),t.set(o,{userA:e,userB:l,createdAt:Date.now(),active:!0}))}),{status:"matched",matchId:r}}async function m(e){await (0,c.oe)((0,c.JU)(u,"queue",e))}function f(e){let{matchId:t,uid:a}=e,[i,l]=(0,s.useState)([]),[r,o]=(0,s.useState)(""),d=(0,s.useRef)(null);async function h(){let e=r.trim();if(!e)return;let n=(0,c.hJ)(u,"matches",t,"messages");await (0,c.ET)(n,{from:a,text:e,ts:(0,c.Bt)()}),o("")}return(0,s.useEffect)(()=>{let e=(0,c.hJ)(u,"matches",t,"messages"),a=(0,c.IO)(e,(0,c.Xo)("ts","asc")),n=(0,c.cf)(a,e=>{let t=[];e.forEach(e=>t.push({id:e.id,...e.data()})),l(t),setTimeout(()=>{var e;return null===(e=d.current)||void 0===e?void 0:e.scrollTo(0,d.current.scrollHeight)},0)});return()=>n()},[t]),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"chat",ref:d,children:[i.map(e=>{var t;return(0,n.jsx)("div",{className:"msg ".concat(e.from===a?"mine":""),children:(0,n.jsxs)("div",{className:"bubble",children:[(0,n.jsx)("div",{children:e.text}),(0,n.jsxs)("div",{className:"meta",children:[e.from===a?"You":"Partner"," \xb7 ",(t=e.ts)?(t.toDate?t.toDate():new Date(t)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""]})]})},e.id)}),0===i.length&&(0,n.jsx)("div",{className:"label",children:"Say hi \uD83D\uDC4B"})]}),(0,n.jsxs)("div",{className:"footer",children:[(0,n.jsx)("input",{className:"input",placeholder:"Type a message…",value:r,onChange:e=>o(e.target.value),onKeyDown:e=>{"Enter"===e.key&&h()}}),(0,n.jsx)("button",{className:"btn",onClick:h,children:"Send"})]})]})}function g(){var e;let[t,a]=(0,s.useState)(null),[i,c]=(0,s.useState)("idle"),[r,u]=(0,s.useState)(null),[g,w]=(0,s.useState)({want:"any"}),[v,j]=(0,s.useState)("");async function x(){if(!t)return;c("waiting"),j("Open another incognito window and click Join there too.");let e=await h(t,g);if("matched"===e.status){u(e.matchId),c("matched"),j("");return}let a=Date.now(),n=async()=>{if(!t||"waiting"!==i)return;let e=await h(t,g);if("matched"===e.status){u(e.matchId),c("matched"),j("");return}Date.now()-a>1e4&&j("Still waiting… be sure you joined from a second window (Incognito)."),setTimeout(n,2500)};setTimeout(n,2500)}async function y(){t&&(await m(t),c("idle"),u(null),j(""))}return(0,s.useEffect)(()=>{d().then(e=>a(e.uid))},[]),(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)("h1",{className:"hero",children:"Anonymous Chat (Free MVP)"}),(0,n.jsx)("p",{className:"sub",children:"Sign-in is anonymous. Text-only chat so it stays 100% free (no credit card)."}),(0,n.jsxs)("div",{className:"card",style:{marginBottom:18},children:[(0,n.jsxs)("div",{className:"row",style:{marginBottom:10},children:[(0,n.jsxs)("span",{className:"status",children:[(0,n.jsx)("span",{style:{width:8,height:8,borderRadius:999,background:"matched"===i?"#22c55e":"#60a5fa",display:"inline-block"}}),"matched"===i?"Matched":"waiting"===i?"Waiting…":"Idle"]}),(0,n.jsx)("span",{className:"label",children:"Want:"}),(0,n.jsxs)("select",{className:"select",value:null!==(e=g.want)&&void 0!==e?e:"any",onChange:e=>w(t=>({...t,want:e.target.value})),children:[(0,n.jsx)("option",{value:"any",children:"Any"}),(0,n.jsx)("option",{value:"male",children:"Male"}),(0,n.jsx)("option",{value:"female",children:"Female"}),(0,n.jsx)("option",{value:"other",children:"Other"})]}),"matched"!==i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{className:"btn",onClick:x,children:"Join Queue"}),(0,n.jsx)("button",{className:"btn ghost",onClick:y,children:"Leave Queue"})]}):(0,n.jsx)("button",{className:"btn ghost",onClick:()=>{c("idle"),u(null)},children:"End Chat"})]}),v&&(0,n.jsx)("div",{className:"label",children:v}),(0,n.jsxs)("div",{className:"row",style:{marginTop:8},children:[(0,n.jsx)("button",{className:"btn ghost",onClick:()=>(0,l.w7)(o),children:"Sign out"}),(0,n.jsxs)("span",{className:"label",children:["uid: ",t]})]})]}),r&&t&&(0,n.jsx)(f,{matchId:r,uid:t})]})}}},function(e){e.O(0,[139,358,537,971,23,744],function(){return e(e.s=762)}),_N_E=e.O()}]);